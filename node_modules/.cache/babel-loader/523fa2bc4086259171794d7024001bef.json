{"ast":null,"code":"import _regeneratorRuntime from\"/media/amine/HDD1/Kraya/2DNI/TP/S2/Framework/Projet/New_NawSociale/node_modules/@babel/runtime/regenerator\";import _asyncToGenerator from\"/media/amine/HDD1/Kraya/2DNI/TP/S2/Framework/Projet/New_NawSociale/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";import _slicedToArray from\"/media/amine/HDD1/Kraya/2DNI/TP/S2/Framework/Projet/New_NawSociale/node_modules/@babel/runtime/helpers/esm/slicedToArray\";import React,{useState,useEffect}from'react';import FlipMove from'react-flip-move';import'./Messages.css';import MessagesFooter from'./MessagesFooter';import MessagesRow from'./MessagesRow';import axios from'./axios';import Pusher from'pusher-js';import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";var pusher=new Pusher('470f630b8e55cfd2fd2c',{cluster:'mt1'});function Messages(props){var _useState=useState(''),_useState2=_slicedToArray(_useState,2),input=_useState2[0],setInput=_useState2[1];var _useState3=useState([]),_useState4=_slicedToArray(_useState3,2),messages=_useState4[0],setMessages=_useState4[1];var _useState5=useState(''),_useState6=_slicedToArray(_useState5,2),username=_useState6[0],setUsername=_useState6[1];var sync=/*#__PURE__*/function(){var _ref=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(){return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:_context.next=2;return axios.get('/retrieve/conversation').then(function(res){console.log(res.data);setMessages(res.data);});case 2:case\"end\":return _context.stop();}}},_callee);}));return function sync(){return _ref.apply(this,arguments);};}();useEffect(function(){sync();},[]);useEffect(function(){var channel=pusher.subscribe('messages');channel.bind('newMessage',function(data){sync();});},[username]);useEffect(function(){setUsername(prompt('Chnowa ismik ?'));},[]);var sendMessage=function sendMessage(event){event.preventDefault();// khater kif 3mlat form, par défaut page trefrechi ro7ha, donc messaget yetfaskhou..\n// function that will allow us to send a message\naxios.post('/save/message',{username:username,message:input,timestamp:Date.now()});//setMessages([...messages, {username: username, message: input}]); // ... hiye append\nsetInput('');};var sendEmoji=function sendEmoji(event){axios.post('/save/message',{username:username,message:'👍',timestamp:Date.now()});};var onChange=function onChange(event){setInput(event.target.value);};return/*#__PURE__*/_jsxs(\"div\",{className:\"messages\",style:{borderColor:props.box__color},children:[/*#__PURE__*/_jsx(\"div\",{className:\"message__body\",children:/*#__PURE__*/_jsx(FlipMove,{children:messages.map(function(message){return/*#__PURE__*/_jsx(MessagesRow,{user:username,mesg:message},message._id);})})}),/*#__PURE__*/_jsx(\"div\",{className:\"message__footer_\",children:/*#__PURE__*/_jsx(MessagesFooter,{input:input,onChange:onChange,sendMessage:sendMessage,sendEmoji:sendEmoji})})]});}export default Messages;","map":{"version":3,"sources":["/media/amine/HDD1/Kraya/2DNI/TP/S2/Framework/Projet/New_NawSociale/src/Messages.js"],"names":["React","useState","useEffect","FlipMove","MessagesFooter","MessagesRow","axios","Pusher","pusher","cluster","Messages","props","input","setInput","messages","setMessages","username","setUsername","sync","get","then","res","console","log","data","channel","subscribe","bind","prompt","sendMessage","event","preventDefault","post","message","timestamp","Date","now","sendEmoji","onChange","target","value","borderColor","box__color","map","_id"],"mappings":"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","sourcesContent":["import React, {useState, useEffect} from 'react';\nimport FlipMove from 'react-flip-move';\nimport './Messages.css';\nimport MessagesFooter from './MessagesFooter';\nimport MessagesRow from './MessagesRow';\nimport axios from './axios';\nimport Pusher from 'pusher-js';\n\nconst pusher = new Pusher('470f630b8e55cfd2fd2c', {\n    cluster: 'mt1'\n  });\n\n\nfunction Messages(props) {\n\n    const [input, setInput] = useState('');\n    \n    const [messages, setMessages] = useState([]);\n    const [username, setUsername] = useState('');\n    \n    \n    const sync = async() => {\n        await axios.get('/retrieve/conversation').then((res) => {\n            console.log(res.data);\n            setMessages(res.data);\n        })\n    };\n\n    useEffect(()=>{\n        sync()\n    }, [])\n\n    useEffect(() => {\n        const channel = pusher.subscribe('messages');\n        channel.bind('newMessage', function(data) {\n            sync();\n        });\n    }, [username])\n\n    useEffect(() => {\n        setUsername(prompt('Chnowa ismik ?'));\n    }, []);\n\n    const sendMessage = event => { \n        event.preventDefault(); // khater kif 3mlat form, par défaut page trefrechi ro7ha, donc messaget yetfaskhou..\n        // function that will allow us to send a message\n        \n        axios.post('/save/message', {\n            username: username,\n            message: input,\n            timestamp: Date.now()\n        })\n        \n        //setMessages([...messages, {username: username, message: input}]); // ... hiye append\n        setInput('');\n    };\n\n    const sendEmoji = event => {\n        \n        axios.post('/save/message', {\n            username: username,\n            message: '👍',\n            timestamp: Date.now()\n        })\n       \n    };\n\n    const onChange = event => {\n        setInput(event.target.value);\n    };\n    return (\n        \n        <div className='messages' style={{borderColor: props.box__color}}>\n            \n            <div className='message__body'>\n\n                <FlipMove>\n                   \n                    {\n                        messages.map(message => (\n                        \n                            <MessagesRow key={message._id} user={username} mesg={message}/>\n\n                        ))\n                    }\n            \n                </FlipMove>\n                \n            </div>\n            \n            <div className='message__footer_'>\n\n                <MessagesFooter input={input} \n                            onChange={onChange} sendMessage={sendMessage} sendEmoji={sendEmoji}/>\n            \n            </div>\n            \n\n        </div>\n    )\n    \n}\n\nexport default Messages"]},"metadata":{},"sourceType":"module"}